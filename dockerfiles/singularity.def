Bootstrap: docker
From: rocker/geospatial:4.2.1

%environment
    export PATH=${PATH}:/usr/local/texlive/bin/x86_64-linux

%post
    export PATH=$PATH:/usr/local/texlive/bin/x86_64-linux
    set -o errexit
    # RELEASE_3_16, 2023-01-23 commit
    wget https://raw.githubusercontent.com/Bioconductor/bioconductor_docker/db4ba859d94a286502c20b6a6d6eb27f91875c24/bioc_scripts/install_bioc_sysdeps.sh
    # use slightly-older apt install versions due to some overlap/conflict with
    # apt-installed python packages from rocker/geospatial
    sed -i'' 's/^pip3 install scikit-learn pandas pyyaml/apt install -y --no-install-recommends python3-sklearn python3-pandas python3-yaml/' install_bioc_sysdeps.sh
    sh install_bioc_sysdeps.sh
    rm install_bioc_sysdeps.sh

    # reticulate
    /rocker_scripts/install_python.sh

    # Install default & yihui TinyTex latex package sets to allow knit-to-PDF
    # (hopefully in most cases) without installation of additional LaTeX packages,
    # as /usr/local/texlive is read-only in the Singularity image
    tlmgr install $(curl https://raw.githubusercontent.com/rstudio/tinytex/v0.42/tools/pkgs-custom.txt | tr '\n' ' ')
    tlmgr install $(curl https://raw.githubusercontent.com/rstudio/tinytex/v0.42/tools/pkgs-yihui.txt | tr '\n' ' ')

%labels
    Author nweeks@g.harvard.edu
