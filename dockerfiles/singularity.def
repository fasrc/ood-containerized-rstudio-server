Bootstrap: docker
From: bioconductor/bioconductor_docker:RELEASE_3_12

# environment variables set by rocker/verse
%environment
    export CTAN_REPO=http://mirror.ctan.org/systems/texlive/tlnet
    export PATH=/usr/local/texlive/bin/x86_64-linux:$PATH

%post

    ######## union rocker/tidyverse
    # https://github.com/rocker-org/rocker-versioned2/blob/master/dockerfiles/Dockerfile_tidyverse_4.0.3

    # work around install_tidyverse.sh default-libmysqlclient-dev installation problem in RELEASE_3_12
    apt update \
      && apt install -y --no-install-recommends libmysqlclient-dev \
      && rm -rf /var/lib/apt/lists/*

    /rocker_scripts/install_tidyverse.sh

    ######## union rocker/verse
    # https://github.com/rocker-org/rocker-versioned2/blob/master/dockerfiles/Dockerfile_verse_4.0.3
    export CTAN_REPO=http://mirror.ctan.org/systems/texlive/tlnet
    export PATH=/usr/local/texlive/bin/x86_64-linux:$PATH
    /rocker_scripts/install_verse.sh

    ######## union rocker/geospatial
    # https://github.com/rocker-org/rocker-versioned2/blob/master/dockerfiles/Dockerfile_geospatial_4.0.3
    /rocker_scripts/install_geospatial.sh

    # Install default & yihui TinyTex latex package sets to allow knit-to-PDF
    # (hopefully in most cases) without installation of additional LaTeX packages,
    # as /usr/local/texlive is read-only in the Singularity image
    tlmgr install $(curl https://raw.githubusercontent.com/yihui/tinytex/v0.27/tools/pkgs-custom.txt | tr '\n' ' ')
    tlmgr install $(curl https://raw.githubusercontent.com/yihui/tinytex/v0.27/tools/pkgs-yihui.txt | tr '\n' ' ')
